<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人设置</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet/less" type="text/css" href="css/main.less">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
</head>
<body>
    <div class="function-page" x-data="settingApp()">
        <div class="page-header">
            <h2><i class="bi bi-gear"></i> 个人设置</h2>
            <p>管理您的个人信息</p>
        </div>
        
        <form @submit.prevent="saveSettings">
            <div class="card mb-4">
                <div class="card-header">
                    <h5><i class="bi bi-person"></i> 基本信息</h5>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="username" class="form-label">用户名</label>
                        <input type="text" class="form-control" id="username" x-model="form.username" readonly>
                        <div class="form-text">用户名不可修改</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="realName" class="form-label">真实姓名 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="realName" x-model="form.realName" placeholder="请输入您的真实姓名" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="workplace" class="form-label">工作单位 <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="workplace" x-model="form.workplace" placeholder="请输入您的工作单位" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="form-label">邮箱地址</label>
                        <input type="email" class="form-control" id="email" x-model="form.email" placeholder="请输入您的邮箱地址">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone" class="form-label">手机号码</label>
                        <input type="tel" class="form-control" id="phone" x-model="form.phone" placeholder="请输入您的手机号码">
                    </div>
                </div>
            </div>
            
            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary" :disabled="loading">
                    <span x-show="!loading">
                        <i class="bi bi-check-circle"></i> 保存设置
                    </span>
                    <span x-show="loading">
                        <div class="spinner-border spinner-border-sm me-2"></div>
                        保存中...
                    </span>
                </button>
                
                <button type="button" class="btn btn-outline-secondary" @click="resetForm">
                    <i class="bi bi-arrow-clockwise"></i> 重置
                </button>
            </div>
        </form>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5><i class="bi bi-shield"></i> 账户操作</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-warning" @click="changePassword">
                        <i class="bi bi-key"></i> 修改密码
                    </button>
                    
                    <button type="button" class="btn btn-outline-danger" @click="logout">
                        <i class="bi bi-box-arrow-right"></i> 退出登录
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/less@4.1.3/dist/less.min.js"></script>
    
    <script>
        function settingApp() {
            return {
                form: {
                    username: '',
                    realName: '',
                    workplace: '',
                    email: '',
                    phone: ''
                },
                loading: false,
                originalForm: null,
                
                init() {
                    this.loadUserInfo();
                    this.loadUserSettings();
                },
                
                loadUserInfo() {
                    const userStr = localStorage.getItem('user');
                    if (userStr) {
                        const user = JSON.parse(userStr);
                        this.form.username = user.username || '';
                    }
                },
                
                async loadUserSettings() {
                    this.loading = true;
                    
                    try {
                        await this.simulateLoadSettings();
                        this.originalForm = JSON.parse(JSON.stringify(this.form));
                    } catch (error) {
                        console.error('加载设置失败:', error);
                    } finally {
                        this.loading = false;
                    }
                },
                
                simulateLoadSettings() {
                    return new Promise((resolve) => {
                        setTimeout(() => {
                            const mockSettings = {
                                realName: '张三',
                                workplace: '某某科技有限公司',
                                email: 'zhangsan@example.com',
                                phone: '13800138000'
                            };
                            
                            Object.assign(this.form, mockSettings);
                            resolve();
                        }, 500);
                    });
                },
                
                async saveSettings() {
                    this.loading = true;
                    
                    try {
                        await this.simulateSaveSettings();
                        alert('设置保存成功！');
                        this.originalForm = JSON.parse(JSON.stringify(this.form));
                    } catch (error) {
                        alert('保存失败：' + error.message);
                    } finally {
                        this.loading = false;
                    }
                },
                
                simulateSaveSettings() {
                    return new Promise((resolve, reject) => {
                        setTimeout(() => {
                            if (!this.form.realName || !this.form.workplace) {
                                reject(new Error('请填写必填项'));
                                return;
                            }
                            
                            localStorage.setItem('userSettings', JSON.stringify(this.form));
                            resolve();
                        }, 1000);
                    });
                },
                
                resetForm() {
                    if (confirm('确定要重置所有设置吗？')) {
                        if (this.originalForm) {
                            this.form = JSON.parse(JSON.stringify(this.originalForm));
                        }
                    }
                },
                
                changePassword() {
                    const newPassword = prompt('请输入新密码：');
                    if (newPassword) {
                        const confirmPassword = prompt('请确认新密码：');
                        if (newPassword === confirmPassword) {
                            alert('密码修改成功！');
                        } else {
                            alert('两次输入的密码不一致！');
                        }
                    }
                },
                
                logout() {
                    if (confirm('确定要退出登录吗？')) {
                        localStorage.removeItem('user');
                        localStorage.removeItem('userSettings');
                        
                        if (window.parent) {
                            window.parent.postMessage({
                                type: 'LOGOUT'
                            }, '*');
                        } else {
                            window.location.href = 'login.html';
                        }
                    }
                }
            }
        }
    </script>
</body>
</html> 