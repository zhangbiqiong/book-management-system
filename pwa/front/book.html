<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图书查询</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet/less" type="text/css" href="css/main.less">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <!-- Less.js -->
    <script src="https://cdn.jsdelivr.net/npm/less@4.1.3/dist/less.min.js"></script>
</head>
<body>
    <div class="function-page" x-data="bookApp()">
        <div class="page-header">
            <h2><i class="bi bi-search"></i> 图书查询</h2>
            <p>搜索您需要的图书信息</p>
        </div>
        
        <div class="search-box">
            <div class="input-group">
                <input type="text" class="form-control" placeholder="输入书名、作者或ISBN进行搜索..." x-model="searchQuery" @keyup.enter="searchBooks" :disabled="loading">
                <button class="btn btn-primary" @click="searchBooks" :disabled="loading">
                    <span x-show="!loading"><i class="bi bi-search"></i> 搜索</span>
                    <span x-show="loading"><div class="spinner-border spinner-border-sm"></div></span>
                </button>
            </div>
        </div>
        
        <div class="mb-3">
            <div class="row g-2">
                <div class="col-6">
                    <select class="form-select" x-model="filterCategory">
                        <option value="">全部分类</option>
                        <option value="文学">文学</option>
                        <option value="科技">科技</option>
                        <option value="历史">历史</option>
                        <option value="艺术">艺术</option>
                    </select>
                </div>
                <div class="col-6">
                    <select class="form-select" x-model="filterStatus">
                        <option value="">全部状态</option>
                        <option value="可借">可借</option>
                        <option value="已借出">已借出</option>
                        <option value="预约中">预约中</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div x-show="!loading && books.length > 0">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-muted">找到 <span x-text="filteredBooks.length"></span> 本图书</span>
            </div>
            
            <div class="book-list">
                <template x-for="book in filteredBooks" :key="book.id">
                    <div class="card book-card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-3">
                                    <div class="book-cover">
                                        <i class="bi bi-book text-primary" style="font-size: 3rem;"></i>
                                    </div>
                                </div>
                                <div class="col-9">
                                    <h5 class="card-title" x-text="book.title"></h5>
                                    <p class="card-text text-muted mb-1">
                                        <i class="bi bi-person"></i> <span x-text="book.author"></span>
                                    </p>
                                    <p class="card-text text-muted mb-1">
                                        <i class="bi bi-tag"></i> <span x-text="book.category"></span>
                                    </p>
                                    <p class="card-text text-muted mb-2">
                                        <i class="bi bi-upc"></i> <span x-text="book.isbn"></span>
                                    </p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="badge" :class="{
                                            'bg-success': book.status === '可借',
                                            'bg-warning': book.status === '已借出',
                                            'bg-info': book.status === '预约中'
                                        }" x-text="book.status"></span>
                                        <button class="btn btn-sm btn-outline-primary" @click="showBookDetail(book)">
                                            <i class="bi bi-eye"></i> 详情
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
        
        <div x-show="loading" class="loading">
            <div class="spinner-border" role="status"></div>
        </div>
        
        <div x-show="!loading && books.length === 0 && hasSearched" class="empty-state">
            <div class="empty-icon"><i class="bi bi-search"></i></div>
            <h3>未找到相关图书</h3>
            <p>请尝试使用其他关键词搜索</p>
        </div>
        
        <div x-show="!loading && books.length === 0 && !hasSearched" class="empty-state">
            <div class="empty-icon"><i class="bi bi-book"></i></div>
            <h3>开始搜索图书</h3>
            <p>在搜索框中输入关键词开始查找</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/less@4.1.3/dist/less.min.js"></script>
    
    <script>
        function bookApp() {
            return {
                searchQuery: '',
                filterCategory: '',
                filterStatus: '',
                books: [],
                loading: false,
                hasSearched: false,
                
                init() {
                    this.loadMockBooks();
                },
                
                async searchBooks() {
                    if (!this.searchQuery.trim()) return;
                    
                    this.loading = true;
                    this.hasSearched = true;
                    
                    try {
                        await this.simulateSearch();
                    } catch (error) {
                        console.error('搜索失败:', error);
                    } finally {
                        this.loading = false;
                    }
                },
                
                simulateSearch() {
                    return new Promise((resolve) => {
                        setTimeout(() => {
                            const mockBooks = [
                                {
                                    id: 1,
                                    title: 'JavaScript高级程序设计',
                                    author: 'Nicholas C. Zakas',
                                    category: '科技',
                                    isbn: '9787115545381',
                                    status: '可借',
                                    description: 'JavaScript经典教程'
                                },
                                {
                                    id: 2,
                                    title: '百年孤独',
                                    author: '加西亚·马尔克斯',
                                    category: '文学',
                                    isbn: '9787544253994',
                                    status: '已借出',
                                    description: '魔幻现实主义文学代表作'
                                },
                                {
                                    id: 3,
                                    title: '人类简史',
                                    author: '尤瓦尔·赫拉利',
                                    category: '历史',
                                    isbn: '9787508640757',
                                    status: '可借',
                                    description: '重新解读人类发展历程'
                                }
                            ];
                            
                            this.books = mockBooks.filter(book => 
                                book.title.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                                book.author.toLowerCase().includes(this.searchQuery.toLowerCase()) ||
                                book.isbn.includes(this.searchQuery)
                            );
                            
                            resolve();
                        }, 1000);
                    });
                },
                
                loadMockBooks() {
                    this.books = [];
                },
                
                showBookDetail(book) {
                    alert(`图书详情：\n书名：${book.title}\n作者：${book.author}\n分类：${book.category}\nISBN：${book.isbn}\n状态：${book.status}`);
                },
                
                get filteredBooks() {
                    let filtered = this.books;
                    
                    if (this.filterCategory) {
                        filtered = filtered.filter(book => book.category === this.filterCategory);
                    }
                    
                    if (this.filterStatus) {
                        filtered = filtered.filter(book => book.status === this.filterStatus);
                    }
                    
                    return filtered;
                }
            }
        }
    </script>
</body>
</html> 